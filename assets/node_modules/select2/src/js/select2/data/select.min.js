define(["./base","../utils","jquery"],function(a,d,c){function b(e,f){this.$element=e;this.options=f;b.__super__.constructor.call(this)}d.Extend(b,a);b.prototype.current=function(g){var f=[];var e=this;this.$element.find(":selected").each(function(){var i=c(this);var h=e.item(i);f.push(h)});g(f)};b.prototype.select=function(f){var e=this;f.selected=true;if(c(f.element).is("option")){f.element.selected=true;this.$element.trigger("change");return}if(this.$element.prop("multiple")){this.current(function(h){var j=[];f=[f];f.push.apply(f,h);for(var i=0;i<f.length;i++){var k=f[i].id;if(c.inArray(k,j)===-1){j.push(k)}}e.$element.val(j);e.$element.trigger("change")})}else{var g=f.id;this.$element.val(g);this.$element.trigger("change")}};b.prototype.unselect=function(f){var e=this;if(!this.$element.prop("multiple")){return}f.selected=false;if(c(f.element).is("option")){f.element.selected=false;this.$element.trigger("change");return}this.current(function(g){var i=[];for(var h=0;h<g.length;h++){var j=g[h].id;if(j!==f.id&&c.inArray(j,i)===-1){i.push(j)}}e.$element.val(i);e.$element.trigger("change")})};b.prototype.bind=function(e,g){var f=this;this.container=e;e.on("select",function(h){f.select(h.data)});e.on("unselect",function(h){f.unselect(h.data)})};b.prototype.destroy=function(){this.$element.find("*").each(function(){c.removeData(this,"data")})};b.prototype.query=function(h,i){var g=[];var f=this;var e=this.$element.children();e.each(function(){var l=c(this);if(!l.is("option")&&!l.is("optgroup")){return}var j=f.item(l);var k=f.matches(h,j);if(k!==null){g.push(k)}});i({results:g})};b.prototype.addOptions=function(e){d.appendMany(this.$element,e)};b.prototype.option=function(f){var e;if(f.children){e=document.createElement("optgroup");e.label=f.text}else{e=document.createElement("option");if(e.textContent!==undefined){e.textContent=f.text}else{e.innerText=f.text}}if(f.id){e.value=f.id}if(f.disabled){e.disabled=true}if(f.selected){e.selected=true}if(f.title){e.title=f.title}var g=c(e);var h=this._normalizeItem(f);h.element=e;c.data(e,"data",h);return g};b.prototype.item=function(i){var h={};h=c.data(i[0],"data");if(h!=null){return h}if(i.is("option")){h={id:i.val(),text:i.text(),disabled:i.prop("disabled"),selected:i.prop("selected"),title:i.prop("title")}}else{if(i.is("optgroup")){h={text:i.prop("label"),children:[],title:i.prop("title")};var e=i.children("option");var f=[];for(var k=0;k<e.length;k++){var g=c(e[k]);var j=this.item(g);f.push(j)}h.children=f}}h=this._normalizeItem(h);h.element=i[0];c.data(i[0],"data",h);return h};b.prototype._normalizeItem=function(e){if(!c.isPlainObject(e)){e={id:e,text:e}}e=c.extend({},{text:""},e);var f={selected:false,disabled:false};if(e.id!=null){e.id=e.id.toString()}if(e.text!=null){e.text=e.text.toString()}if(e._resultId==null&&e.id&&this.container!=null){e._resultId=this.generateResultId(this.container,e)}return c.extend({},f,e)};b.prototype.matches=function(g,e){var f=this.options.get("matcher");return f(g,e)};return b});