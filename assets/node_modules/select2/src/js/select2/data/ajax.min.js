define(["./array","../utils","jquery"],function(d,c,b){function a(e,f){this.ajaxOptions=this._applyDefaults(f.get("ajax"));if(this.ajaxOptions.processResults!=null){this.processResults=this.ajaxOptions.processResults}a.__super__.constructor.call(this,e,f)}c.Extend(a,d);a.prototype._applyDefaults=function(e){var f={data:function(g){return b.extend({},g,{q:g.term})},transport:function(j,i,h){var g=b.ajax(j);g.then(i);g.fail(h);return g}};return b.extend({},f,e,true)};a.prototype.processResults=function(e){return e};a.prototype.query=function(i,j){var h=[];var e=this;if(this._request!=null){if(b.isFunction(this._request.abort)){this._request.abort()}this._request=null}var f=b.extend({type:"GET"},this.ajaxOptions);if(typeof f.url==="function"){f.url=f.url.call(this.$element,i)}if(typeof f.data==="function"){f.data=f.data.call(this.$element,i)}function g(){var k=f.transport(f,function(m){var l=e.processResults(m,i);if(e.options.get("debug")&&window.console&&console.error){if(!l||!l.results||!b.isArray(l.results)){console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")}}j(l)},function(){if(k.status&&k.status==="0"){return}e.trigger("results:message",{message:"errorLoading"})});e._request=k}if(this.ajaxOptions.delay&&i.term!=null){if(this._queryTimeout){window.clearTimeout(this._queryTimeout)}this._queryTimeout=window.setTimeout(g,this.ajaxOptions.delay)}else{g()}};return a});